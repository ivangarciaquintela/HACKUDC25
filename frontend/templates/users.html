<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users - Technical Skills Registry</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <nav>
            <h1>Technical Skills Registry</h1>
            <div class="nav-links" id="navLinks">
                <a href="/">Home</a>
                <a href="/search.html">Search Skills</a>
                <a href="/users.html">Users</a>
                <a href="/profile.html">Profile</a>
                <a href="#" id="logoutLink">Logout</a>
            </div>
        </nav>
    </header>

    <main>
        <div class="users-container">
            <h2>Browse Users</h2>
            
            <div class="search-filters">
                <div class="search-row">
                    <input type="text" id="searchInput" placeholder="Search users..." class="search-input">
                    <select id="skillFilter" class="skill-select">
                        <option value="">Filter by Skill</option>
                    </select>
                    <select id="skillLevelFilter" class="level-select">
                        <option value="">Any Proficiency</option>
                        <option value="5">Expert (Level 5)</option>
                        <option value="4">Advanced (Level 4)</option>
                        <option value="3">Intermediate (Level 3)</option>
                        <option value="2">Basic (Level 2)</option>
                        <option value="1">Beginner (Level 1)</option>
                    </select>
                    <button onclick="searchUsers()" class="search-button">Search</button>
                </div>
            </div>

            <div class="users-grid" id="usersGrid">
                <!-- Users will be displayed here -->
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Technical Skills Registry</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadSkills();
            searchUsers();
        });

        async function loadSkills() {
            try {
                const response = await fetch('http://localhost:8000/skills/search');
                const skills = await response.json();
                
                const select = document.getElementById('skillFilter');
                const uniqueSkills = new Set(skills.map(skill => skill.name));
                
                Array.from(uniqueSkills).sort().forEach(skillName => {
                    const option = document.createElement('option');
                    option.value = skillName;
                    option.textContent = skillName;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading skills:', error);
            }
        }

        async function searchUsers() {
            const searchQuery = document.getElementById('searchInput').value;
            const skillFilter = document.getElementById('skillFilter').value;
            const skillLevel = document.getElementById('skillLevelFilter').value;
            
            try {
                const params = new URLSearchParams();
                if (searchQuery) params.append('q', searchQuery);
                if (skillFilter) params.append('skill', skillFilter);
                if (skillLevel) params.append('min_level', skillLevel);
                
                const response = await fetch(`http://localhost:8000/users/search?${params}`);
                const users = await response.json();
                
                displayUsers(users);
            } catch (error) {
                console.error('Error searching users:', error);
                document.getElementById('usersGrid').innerHTML = `
                    <div class="error-message">
                        Error loading users. Please try again later.
                    </div>
                `;
            }
        }

        function displayUsers(users) {
            const grid = document.getElementById('usersGrid');
            
            if (users.length === 0) {
                grid.innerHTML = '<p class="no-users">No users found matching your criteria.</p>';
                return;
            }

            grid.innerHTML = users.map(user => `
                <div class="user-list-card">
                    <div class="user-info">
                        <h3>
                            <a href="/user-profile.html?username=${user.username}" class="user-link">
                                ${user.username}
                            </a>
                        </h3>
                        <p class="member-since">Member since ${new Date(user.created_at).toLocaleDateString()}</p>
                    </div>
                    <div class="user-skills-preview">
                        <h4>Top Skills:</h4>
                        <div class="skills-list">
                            ${user.top_skills.map(skill => `
                                <div class="skill-tag">
                                    <span class="skill-name">${skill.name}</span>
                                    <span class="skill-level">(${skill.proficiency_level}/5)</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="total-skills">
                        <span class="skills-count">${user.total_skills} total skills</span>
                        <a href="/user-profile.html?username=${user.username}" class="view-profile-btn">View Profile</a>
                    </div>
                </div>
            `).join('');
        }

        // Add event listeners for search input
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchUsers();
            }
        });
    </script>
</body>
</html> 