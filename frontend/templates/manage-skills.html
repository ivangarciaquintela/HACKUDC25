{% extends "base.html" %}
{% block title %}Manage Skills - Technical Skills Registry{% endblock %}
{% block content %}

<div x-data="skillForm" class="container mx-auto px-8 lg:px-16 py-8 max-w-3xl">
    <h1 class="text-2xl font-bold mb-6">Add New Skill</h1>
    
    <form @submit.prevent="submitForm" class="space-y-6 bg-white p-6 rounded-lg shadow-md border border-orange-200">
        <!-- Name -->
        <div>
            <label for="name" class="block text-sm font-medium text-gray-700">Skill Name</label>
            <input type="text" id="name" x-model="formData.name" required
                   class="mt-1 block w-full rounded-md border-orange-200 shadow-sm focus:border-orange-400 focus:ring-2 focus:ring-orange-200">
        </div>

        <!-- Version -->
        <div>
            <label for="version" class="block text-sm font-medium text-gray-700">Version</label>
            <input type="text" id="version" x-model="formData.version" required
                   class="mt-1 block w-full rounded-md border-orange-200 shadow-sm focus:border-orange-400 focus:ring-2 focus:ring-orange-200">
        </div>

        <!-- Category -->
        <div>
            <label for="category" class="block text-sm font-medium text-gray-700">Category</label>
            <input type="text" id="category" x-model="formData.category" required
                   class="mt-1 block w-full rounded-md border-orange-200 shadow-sm focus:border-orange-400 focus:ring-2 focus:ring-orange-200">
        </div>

        <!-- Description -->
        <div>
            <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
            <textarea id="description" x-model="formData.description" rows="4" required
                      class="mt-1 block w-full rounded-md border-orange-200 shadow-sm focus:border-orange-400 focus:ring-2 focus:ring-orange-200"></textarea>
        </div>

        <!-- Proficiency Level -->
        <div>
            <label for="proficiency" class="block text-sm font-medium text-gray-700">Proficiency Level (1-5)</label>
            <input type="number" id="proficiency" x-model="formData.proficiency_level" min="1" max="5" required
                   class="mt-1 block w-full rounded-md border-orange-200 shadow-sm focus:border-orange-400 focus:ring-2 focus:ring-orange-200">
        </div>

        <!-- Years of Experience -->
        <div>
            <label for="experience" class="block text-sm font-medium text-gray-700">Years of Experience</label>
            <input type="number" id="experience" x-model="formData.years_experience" min="0" step="0.5" required
                   class="mt-1 block w-full rounded-md border-orange-200 shadow-sm focus:border-orange-400 focus:ring-2 focus:ring-orange-200">
        </div>

        <!-- Submit Button -->
        <div class="flex justify-end">
            <button type="submit" 
                    class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-black font-medium rounded-lg transition-colors duration-200">
                Add Skill
            </button>
        </div>

        <!-- Error Message -->
        <div x-show="errorMessage" 
             x-text="errorMessage"
             class="mt-4 p-4 bg-red-100 text-red-700 rounded-lg"
             x-transition></div>

        <!-- Success Message -->
        <div x-show="successMessage" 
             x-text="successMessage"
             class="mt-4 p-4 bg-green-100 text-green-700 rounded-lg"
             x-transition></div>
    </form>
</div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('skillForm', () => ({
            formData: {
                name: '',
                version: '',
                category: '',
                description: '',
                proficiency_level: 1,
                years_experience: 0
            },
            errorMessage: '',
            successMessage: '',
            async submitForm() {
                this.errorMessage = '';
                this.successMessage = '';

                try {
                    const response = await fetch(`/users/{{ user.username }}/skills`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(this.formData)
                    });

                    if (response.ok) {
                        this.successMessage = 'Skill added successfully!';
                        // Reset form
                        this.formData = {
                            name: '',
                            version: '',
                            category: '',
                            description: '',
                            proficiency_level: 1,
                            years_experience: 0
                        };
                    } else {
                        const data = await response.json();
                        this.errorMessage = data.detail || 'An error occurred while adding the skill.';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    this.errorMessage = 'An error occurred while adding the skill.';
                }
            }
        }))
    })
</script>

{% endblock %}
