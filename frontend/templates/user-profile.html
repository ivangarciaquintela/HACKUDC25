<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - Technical Skills Registry</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <nav>
            <h1>Technical Skills Registry</h1>
            <div class="nav-links" id="navLinks">
                <a href="/">Home</a>
                <a href="/search.html">Search Skills</a>
                <a href="/users.html">Users</a>
                <a href="/profile.html">Profile</a>
                <a href="#" id="logoutLink">Logout</a>
            </div>
        </nav>
    </header>

    <main>
        <div class="user-profile-container">
            <div class="user-header">
                <h2 id="username"></h2>
                <p id="userEmail" class="user-email"></p>
                <p id="memberSince" class="member-since"></p>
            </div>

            <div class="skills-section">
                <h3>Skills</h3>
                <div class="skills-categories">
                    <div class="category-filters" id="categoryFilters">
                        <button class="category-filter active" data-category="all">All</button>
                    </div>
                </div>
                
                <div class="user-skills-grid" id="userSkillsGrid">
                    <!-- Skills will be displayed here -->
                </div>
            </div>

            <div class="guides-section">
                <h3>Guides</h3>
                <div class="guides-grid" id="guidesGrid">
                    <!-- Guides will be displayed here -->
                </div>
            </div>

            <div class="issues-section">
                <h3>Issues</h3>
                <div class="issues-grid" id="issuesGrid">
                    <!-- Issues will be displayed here -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Technical Skills Registry</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get username from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const username = urlParams.get('username');
            
            if (!username) {
                window.location.href = '/search.html';
                return;
            }

            loadUserProfile(username);
            loadUserSkills(username);
            loadUserGuides(username);
            loadUserIssues(username);
        });

        async function loadUserProfile(username) {
            try {
                const response = await fetch(`http://localhost:8000/users/${username}`);
                const user = await response.json();
                
                document.getElementById('username').textContent = user.username;
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('memberSince').textContent = 
                    `Member since ${new Date(user.created_at).toLocaleDateString()}`;
                
                document.title = `${user.username}'s Profile - Technical Skills Registry`;
            } catch (error) {
                console.error('Error loading user profile:', error);
                document.querySelector('.user-profile-container').innerHTML = `
                    <div class="error-message">
                        Error loading user profile. Please try again later.
                    </div>
                `;
            }
        }

        async function loadUserSkills(username) {
            try {
                const response = await fetch(`http://localhost:8000/users/${username}/skills`);
                const skills = await response.json();
                
                // Update category filters
                const categories = [...new Set(skills.map(skill => skill.category))];
                const categoryFilters = document.getElementById('categoryFilters');
                categories.forEach(category => {
                    const button = document.createElement('button');
                    button.className = 'category-filter';
                    button.textContent = category;
                    button.dataset.category = category;
                    button.onclick = () => filterSkills(category);
                    categoryFilters.appendChild(button);
                });

                // Store skills globally for filtering
                window.userSkills = skills;
                displaySkills(skills);
            } catch (error) {
                console.error('Error loading user skills:', error);
                document.getElementById('userSkillsGrid').innerHTML = `
                    <div class="error-message">
                        Error loading skills. Please try again later.
                    </div>
                `;
            }
        }

        function displaySkills(skills) {
            const grid = document.getElementById('userSkillsGrid');
            
            if (skills.length === 0) {
                grid.innerHTML = '<p class="no-skills">No skills added yet.</p>';
                return;
            }

            grid.innerHTML = skills.map(skill => `
                <div class="user-skill-card">
                    <div class="skill-info">
                        <h4>
                            <a href="/skill.html?id=${skill.skill_id}" class="skill-link">
                                ${skill.name}
                            </a>
                            <span class="version">${skill.version || ''}</span>
                        </h4>
                        <p class="category">${skill.category}</p>
                    </div>
                    <div class="skill-stats">
                        <div class="stat">
                            <span class="stat-label">Proficiency:</span>
                            <div class="proficiency-bar">
                                <div class="proficiency-fill" style="width: ${(skill.proficiency_level / 5) * 100}%">
                                    ${skill.proficiency_level}/5
                                </div>
                            </div>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Experience:</span>
                            <span class="stat-value">${skill.years_experience} years</span>
                        </div>
                        ${skill.last_used_date ? `
                        <div class="stat">
                            <span class="stat-label">Last Used:</span>
                            <span class="stat-value">${new Date(skill.last_used_date).toLocaleDateString()}</span>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function filterSkills(category) {
            // Update active filter button
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.category === category);
            });

            // Filter skills
            const filteredSkills = category === 'all' 
                ? window.userSkills 
                : window.userSkills.filter(skill => skill.category === category);
            
            displaySkills(filteredSkills);
        }

        async function loadUserGuides(username) {
            try {
                const response = await fetch(`http://localhost:8000/users/${username}/guides`);
                const guides = await response.json();
                
                const guidesGrid = document.getElementById('guidesGrid');
                
                if (guides.length === 0) {
                    guidesGrid.innerHTML = '<p class="no-guides">No guides created yet.</p>';
                    return;
                }

                guidesGrid.innerHTML = guides.map(guide => `
                    <div class="guide-card">
                        <h4>${guide.title}</h4>
                        <div class="guide-content">${marked.parse(guide.content)}</div>
                        <div class="guide-meta">
                            <span class="guide-skill">
                                Skill: ${guide.skill_name} ${guide.skill_version ? `(${guide.skill_version})` : ''}
                            </span>
                            <span class="guide-date">
                                Created: ${new Date(guide.created_at).toLocaleDateString()}
                            </span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading user guides:', error);
                document.getElementById('guidesGrid').innerHTML = `
                    <div class="error-message">
                        Error loading guides. Please try again later.
                    </div>
                `;
            }
        }

        async function loadUserIssues(username) {
            try {
                const response = await fetch(`http://localhost:8000/users/${username}/issues`);
                const issues = await response.json();
                
                const issuesGrid = document.getElementById('issuesGrid');
                
                if (issues.length === 0) {
                    issuesGrid.innerHTML = '<p class="no-issues">No issues reported yet.</p>';
                    return;
                }

                issuesGrid.innerHTML = issues.map(issue => `
                    <div class="issue-card">
                        <h4>${issue.title}</h4>
                        <div class="issue-content">${issue.description}</div>
                        <div class="issue-meta">
                            <span class="issue-skill">
                                Skill: ${issue.skill_name} ${issue.skill_version ? `(${issue.skill_version})` : ''}
                            </span>
                            <span class="issue-date">
                                Created: ${new Date(issue.created_at).toLocaleDateString()}
                            </span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading user issues:', error);
                document.getElementById('issuesGrid').innerHTML = `
                    <div class="error-message">
                        Error loading issues. Please try again later.
                    </div>
                `;
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html> 