{% extends "base.html" %}
{% block title %}Skills - Technical Skills Registry{% endblock %}
{% block content %}

<div x-data="skillApp" class="container mx-auto mt-10">
    <!-- Search Bar -->
    <div class="max-w-3xl mx-auto mb-6 flex flex-wrap gap-4">
        {% include "search-bar.html" %}
        
        <select id="categorySelect" class="rounded-lg border border-gray-300 px-4 py-2 bg-white shadow-sm" x-model="filters.category">
            <option value="">All Categories</option>
        </select>

        <!-- <select id="versionSelect" class="rounded-lg border border-gray-300 px-4 py-2 bg-white shadow-sm" x-model="filters.version">
            <option value="">All Versions</option>
        </select> -->
    </div>

    <!-- Skills Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6">
        <template x-for="skill in filteredSkills" :key="skill.id">
            <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <h3 class="text-lg font-semibold mb-2" x-text="skill.name"></h3>
                <p class="text-gray-600 mb-4" x-text="skill.description"></p>
                <div class="flex items-center text-sm text-gray-500 mb-2">
                    <span>Version: <span x-text="skill.version"></span></span>
                    <span class="ml-4">Category: <span x-text="skill.category"></span></span>
                </div>
            </div>
        </template>
    </div>
</div>

<script src="/static/getElements.js"></script>
<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('skillApp', () => ({
            searchQuery: '',
            filters: {
                category: '',
                version: ''
            },
            skills: [],
            async fetchSkills() {
                try {
                    const response = await fetch('http://localhost:8000/skills/search');
                    const skills = await response.json();
                    this.skills = skills;
                } catch (error) {
                    console.error('Error fetching skills:', error);
                }
            },
            get filteredSkills() {
                return this.skills.filter(skill => {
                    return (this.searchQuery === '' || skill.name.toLowerCase().includes(this.searchQuery.toLowerCase())) &&
                        (this.filters.category === '' || skill.category === this.filters.category) &&
                        (this.filters.version === '' || skill.version === this.filters.version);
                });
            },
            performSearch() {
                console.log('Searching:', this.searchQuery, this.filters);
            },
            init() {
                this.fetchSkills();
                fetchCategories(); // Call the function from getElements.js
            }
        }))
    })

    async function fetchCategories() { // TODO move this to getElements
        try {   
            const response = await fetch('http://localhost:8000/skills/categories');
            const categories = await response.json();
            const categorySelect = document.getElementById('categorySelect');

            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        } catch (error) {
            console.error('Error fetching categories:', error);
        }
    }  
</script>
{% endblock %}